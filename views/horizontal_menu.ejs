<!DOCTYPE html>
<html data-bs-theme="light" lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title><%= user.company_name %></title>
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/horizontalmenu.css">
    <style>
        div.scrollmenu a.nav-link.active {
            border: 1px solid <%= background_color %>;
        }
    </style>
</head>

<body data-bs-spy="scroll" data-bs-target="#categories-list" data-bs-offset="50">
    <!-- Google Translate Script -->
    <script>
        (function () {
            var e = document.createElement("script");
            e.type = "text/javascript";
            e.async = true;
            e.src = "//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit";
            var a = document.getElementsByTagName("script")[0];
            a.parentNode.insertBefore(e, a);
        })();
    </script>

    <!-- Google Translate Initialization Function -->
    <script>
        function googleTranslateElementInit() {
            new google.translate.TranslateElement({
                pageLanguage: '<%= language[0].code %>',
                includedLanguages: '',
            }, 'google_translate_element');
        }
    </script>

    <!-- Google Translate Element -->
    <div id="google_translate_element"></div>

    <div style="width: 100%; height: 50%; min-height: 240px; max-height: 450px; background: url(<%= backgroundImage %>) center / cover no-repeat;">
        <!--<h1 style="text-align: center; padding-top: 30%; color: black;">Jankoia Restaurant Menu</h1>-->
    </div>
    <div class="container" style="padding-top:40px; padding-bottom:60px;">
        <div>
            <div class="col scrollmenu" id="categories-list">
                <% categories.forEach(function (category) { %>
                    <a class="nav-link" href="#category-<%= category.category_id %>"><%= category.category_name %></a>
                <% }); %>
            </div>
            <div class="col items" style="text-align: center; margin-top:30px;">
                <% categories.forEach(function (category) { %>
                    <div id="category-<%= category.category_id %>">
                        <a class="link" style="position: relative;"><%= category.category_name %></a>
                        <div style="border-bottom: 2px solid <%= background_color %>; width: 50%; text-align: center; margin:auto;"></div>
                        <div style="text-align: left; margin-top: 20px;">
                            <div>
                                <% category.items.forEach(function (item) { %>
                                    <div class="custom-card" onclick="openModal('<%= item.item_name %>', '<%= item.price %> <%= currency %>', '<%= item.description %>', '<%= item.image ? item.image : '/img/light_gray.jpg' %>', '<%= item.allergies %>', '<%= item.food_type %>')">
                                        <% if (item.image) { %>
                                            <img src="<%= item.image %>" alt="<%= item.item_name %>">
                                        <% } else { %>
                                            <img src="/img/light_gray.jpg" alt="light_gray photo">
                                        <% } %>
                                        <div class="card-content">
                                            <h5><%= item.item_name %></h5>
                                            <% if (item.food_type === 'Vegan') { %>
                                                <div class="vegan-badge">
                                                    <img src="/img/vegan.jpg" style="max-width: 30px; max-height: 30px;" alt="">
                                                </div>
                                            <% } else if (item.food_type === 'Vegetarian') { %>
                                                <div class="vegan-badge">
                                                    <img src="/img/vegetarian.jpg" style="max-width: 30px; max-height: 30px;" alt="">
                                                </div>
                                            <% } %>
                                            <div class="price"><%= item.price %> <%= currency %></div>
                                            <div class="description"><%= item.description.length > 120 ? item.description.substring(0, 120) + '...' : item.description %></div>
                                            <div class="allergy-letter">
                                                <% if (item.allergies) { %>
                                                    <% item.allergies.forEach(allergy => { %>
                                                        (<%= allergy %>)
                                                    <% }) %>
                                                <% } %>
                                            </div>
                                        </div>
                                    </div>
                                <% }); %>
                            </div>
                        </div>
                    </div>
                <% }); %>
            </div>
        </div>
    </div>

    <!-- The Modal -->
    <div id="myModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <img id="modalImage" src="" alt="">
            <h2 id="modalItemName"></h2>
            <div id="modalPrice"></div>
            <p id="modalDescription"></p>
            <div id="modalAllergy" class="allergy-info"></div>
            <div id="modalFoodType" class="food-type-info">
                <img id="modalFoodTypeImage" src="" alt="" style="max-width: 30px; max-height: 30px;">
            </div>
        </div>
    </div>

    <!-- Include jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Bootstrap Bundle with Popper -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>

    <script>
document.addEventListener('DOMContentLoaded', function () {
    var scrollSpy = new bootstrap.ScrollSpy(document.body, {
        target: '#categories-list'
    });

    var dataSpyList = [].slice.call(document.querySelectorAll('[data-bs-spy="scroll"]'));
    dataSpyList.forEach(function (dataSpyEl) {
        bootstrap.ScrollSpy.getInstance(dataSpyEl).refresh();
    });

    var firstScrollSpyEl = document.querySelector('[data-bs-spy="scroll"]');
    firstScrollSpyEl.addEventListener('activate.bs.scrollspy', function (event) {
        var activeLink = event.relatedTarget;
        var scrollmenu = document.getElementById('categories-list');
        var scrollmenuWidth = scrollmenu.offsetWidth;
        var activeLinkWidth = activeLink.offsetWidth;
        var activeLinkOffsetLeft = activeLink.offsetLeft;

        // Calculate the scroll position to center the active link
        var scrollPosition = activeLinkOffsetLeft - (scrollmenuWidth / 2) + (activeLinkWidth / 2);

        // Ensure the scroll position doesn't exceed the scrollable range
        var maxScrollPosition = scrollmenu.scrollWidth - scrollmenuWidth;
        if (scrollPosition > maxScrollPosition) {
            scrollPosition = maxScrollPosition;
        }
        if (scrollPosition < 0) {
            scrollPosition = 0;
        }

        scrollmenu.scrollTo({
            left: scrollPosition,
            behavior: 'smooth'
        });
    });

    // Add click event listener to the nav-links for smooth scroll
    var navLinks = document.querySelectorAll('#categories-list .nav-link');
    navLinks.forEach(function (navLink) {
        navLink.addEventListener('click', function (event) {
            event.preventDefault();
            var targetId = this.getAttribute('href').substring(1);
            var targetElement = document.getElementById(targetId);
            var offsetTop = targetElement.offsetTop;

            window.scrollTo({
                top: offsetTop,
                behavior: 'smooth'
            });
        });
    });
});

    </script>

    <script>
        // JavaScript to handle the modal
        var modal = document.getElementById("myModal");
        var span = document.getElementsByClassName("close")[0];

        function openModal(name, price, description, image, allergies, foodType) {
            document.getElementById("modalItemName").innerText = name;
            document.getElementById("modalPrice").innerText = price;
            document.getElementById("modalDescription").innerText = description;
            document.getElementById("modalImage").src = image;

            if (allergies) {
                document.getElementById("modalAllergy").innerText = allergies;
            } else {
                document.getElementById("modalAllergy").innerText = '';
            }

            var foodTypeImage = '';
            if (foodType === 'Vegan') {
                foodTypeImage = '/img/vegan.jpg';
            } else if (foodType === 'Vegetarian') {
                foodTypeImage = '/img/vegetarian.jpg';
            } else {
                foodTypeImage = ''; // No image for other types
            }
            document.getElementById("modalFoodTypeImage").src = foodTypeImage;

            modal.style.display = "block";
            document.body.classList.add("modal-open");
        }

        span.onclick = function () {
            modal.style.display = "none";
            document.body.classList.remove("modal-open");
        }

        window.onclick = function (event) {
            if (event.target == modal) {
                modal.style.display = "none";
                document.body.classList.remove("modal-open");
            }
        }
    </script>

    <script>
        function applyCustomStyles() {
            var iframe = document.querySelector('iframe.VIpgJd-ZVi9od-xl07Ob-OEVmcd');
            if (iframe) {
                var iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                console.log(iframeDoc);
                var style = document.createElement('style');
                style.textContent = `
            .VIpgJd-ZVi9od-vH1Gmf {
                text-align: center!important;
            }

            .indicator{
                display: none !important;
            }

              .VIpgJd-ZVi9od-vH1Gmf-ibnC6b{
            border-radius: 8px !important;
            width: 400px !important;
        }

        VIpgJd-ZVi9od-vH1Gmf{
            display: none !important; 
        }

            VIpgJd-ZVi9od-vH1Gmf-ibnC6b div:hover {
                background-color: #f1f1f1;
            }

            .VIpgJd-ZVi9od-l4eHX-hSRGPd{
                display: none !important;
            }
        `;
                iframeDoc.head.appendChild(style);
                var iframeee = iframeDoc.querySelector('.VIpgJd-ZVi9od-vH1Gmf-ibnC6b');
            } else {
                setTimeout(applyCustomStyles, 500);
            }
        }

        // Wait for the iframe to load and then apply styles
        window.addEventListener('load', function () {
            setTimeout(applyCustomStyles, 500);
        });
    </script>
</body>

</html>
